# 类型生成配置说明

## 概述

本文档说明 Orval 的类型生成配置，以及如何确保生成完整的请求参数类型、响应数据类型和错误类型。

## 配置项说明

### 1. 完整的请求参数类型（需求 1.4）

Orval 默认会为每个 API 端点生成完整的请求参数类型，包括：

- **路径参数（Path Parameters）**：如 `DeleteUsersIdPathParameters`
- **查询参数（Query Parameters）**：如 `GetUsersParams`
- **请求体（Request Body）**：如 `InternalApiHandlerCreateUserRequestBody`

#### 示例

```typescript
// 查询参数类型
export type GetUsersParams = {
  /**
   * 页码
   * @minimum 1
   */
  pageNo?: number
  /**
   * 每页大小
   * @minimum 1
   * @maximum 100
   */
  pageSize?: number
}

// 路径参数类型
export type DeleteUsersIdPathParameters = {
  id: string
}
```

### 2. 完整的响应数据类型（需求 1.5）

Orval 会为每个 API 端点生成完整的响应类型，包括：

- **成功响应类型**：如 `GenkitAiServiceInternalModelUserDataResponse`
- **数据模型类型**：如 `GenkitAiServiceInternalModelUser`
- **列表响应类型**：如 `GenkitAiServiceInternalModelUserListResponse`

#### 示例

```typescript
// 响应数据类型
export interface GenkitAiServiceInternalModelUserDataResponse {
  /** 响应代码 */
  code?: number
  /** 响应数据 */
  data?: GenkitAiServiceInternalModelUser
  /** 响应信息 */
  message?: string
}

// 用户数据模型
export interface GenkitAiServiceInternalModelUser {
  /** 用户ID */
  id?: string
  /** 用户邮箱，在租户内唯一 */
  email?: string
  /** 显示名称 */
  displayName?: string
  // ... 其他字段
}
```

### 3. 错误类型（需求 2.5）

Orval 会从 OpenAPI 文档的 `responses` 部分提取错误响应类型：

```typescript
// 错误响应类型
export interface GenkitAiServiceInternalModelErrorResponse {
  /** 响应代码 */
  code?: number
  /** 响应信息 */
  message?: string
}
```

### 4. JSDoc 注释（需求 2.5）

Orval 会自动从 OpenAPI 文档的 `description` 字段生成 JSDoc 注释：

```typescript
/**
 * 用户信息，包含用户的基本信息、角色和状态
 */
export interface GenkitAiServiceInternalModelUser {
  /** 创建时间 */
  createdAt?: string
  /** 用户邮箱，在租户内唯一 */
  email?: string
  // ...
}
```

## API 服务中的类型使用

生成的 API 服务代码会使用这些类型：

```typescript
/**
 * 获取当前租户下的用户列表，支持分页（需要租户管理员权限）
 * @summary 获取用户列表
 */
const getUsers = (params: GetUsersParams) => {
  return orvalMutator<GenkitAiServiceInternalModelUserListResponse>({
    url: `/users`,
    method: 'GET',
    params,
  })
}
```

## 类型导出

Orval 还会为每个 API 函数生成返回类型的辅助类型：

```typescript
export type GetUsersResult = NonNullable<
  Awaited<ReturnType<ReturnType<typeof getUserManagement>['getUsers']>>
>
```

这些类型可以在业务代码中使用：

```typescript
import { getUserManagement } from '@/services/api/user-management'
import type { GetUsersResult } from '@/services/api/user-management'

const userApi = getUserManagement()

// 使用类型
const handleGetUsers = async (): Promise<GetUsersResult> => {
  return await userApi.getUsers({ pageNo: 1, pageSize: 10 })
}
```

## 配置验证

### 验证步骤

1. **类型检查**：运行 `yarn typecheck` 确保生成的代码通过 TypeScript 类型检查
2. **代码规范**：运行 `yarn lint` 确保生成的代码符合 ESLint 规则
3. **格式化**：Orval 配置了 `prettier: true`，生成的代码会自动格式化

### 验证结果

✅ 所有生成的类型文件都通过了 TypeScript 严格模式检查
✅ 生成的代码包含完整的 JSDoc 注释
✅ 请求参数类型、响应类型和错误类型都已正确生成
✅ 类型定义包含了验证规则（如 `@minimum`、`@maximum`）

## 总结

通过 Orval 的默认配置和项目的 TypeScript 严格模式，我们已经实现了：

1. ✅ 生成完整的请求参数类型（路径参数、查询参数、请求体）
2. ✅ 生成完整的响应数据类型
3. ✅ 生成错误类型
4. ✅ 生成的类型包含 JSDoc 注释

所有类型都是类型安全的，并且与 OpenAPI 文档保持同步。
